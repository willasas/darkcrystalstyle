<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/video-js.min.css">
  <title>video js demo</title>
</head>
<body>
  <div class="data-vjs-player">
    <!-- type1-- via data-setup -->
    <video id="vid1" class="video-js vjs-16-9 vjs-fluid vjs-playback-rate" data-setup="{}">
      <source src="//vjs.zencdn.net/v/oceans.mp4" type="video/mp4">
      <source src="//vjs.zencdn.net/v/oceans.webm" type="video/webm">
      <!-- 文本轨道（WebVTT） -->
      <track kind="captions" src="image/example-captions.vtt" srclang="zh-CN" label="English" default>
    </video>
    <!-- <video-js id="vid1" class="video-js" data-setup='{"controls": true, "autoplay": false, "preload": "auto"}'></video-js> -->
  </div>



  <!-- type2-- video-js embed -->
  <!-- <video-js id="vid2" class="video-js vjs-16-9 vjs-fluid vjs-playback-rate" data-setup="{}">
    <source src="//vjs.zencdn.net/v/oceans.mp4" type="video/mp4">
    <source src="//vjs.zencdn.net/v/oceans.webm" type="video/webm">
  </video-js> -->




  <!-- video.js 视频插件 -->
  <script src="js/video.min.js"></script>
  <!-- video.js 修改默认语言为“简体中文” -->
  <script src="js/zh-CN.js"></script>
  <!-- 检测浏览器是否支持(音频、视频)自动播放 -->
  <script src="js/can-autoplay.js"></script>

  <script>
    // type 1 
    // 若在video标签中的data-setup属性中配置了controls，autoplay和preload等属性，这此js中的参数不需要配置；即二选一
    const player = videojs('vid1', {
      controls: true,
      controlBar: {
        remainingTimeDisplay: {
          displayNegative: false
        }
      },
      autoplay: 'muted',
      preload: 'auto',
      crossorigin: 'anonymous',
      poster: 'https://lh6.googleusercontent.com/proxy/MdXBfxi4vCF0ZKalCD1XFNnrumrgr3DoIIwdqaPlZG9Q0K4hUVQQUGfBnqzm3-jY1EJEREorVqCj7TUKyEqhPiz32FyE051g9G8sMKhGdyM=w3840-h2160-p-k-no-nd-mv',
      preload: 'auto',
      width: 980,
      height: 420,
      preferFullWindow: true,
      language: 'zh-CN',
      playbackRates: [0.5, 1, 1.25, 1.5, 2],
      plugin: {
        foo: {bar: true},
        boo: {baz: false}
      },
      // sources:[{
      //   src: '//vjs.zencdn.net/v/oceans.mp4',
      //   type: 'video/mp4'
      // },{
      //   src: '//vjs.zencdn.net/v/oceans.webm',
      //   type: 'video/webm'
      // }],
      userActions: {
        hotkeys: function(event){
          // `x` key = pause
          if(event.which === 88){
            this.pause();
          }
          // `y` key = play
          if(event.which === 89){
            this.play();
          }
        }
      },
      // children:[

      // ],
      nativeControlsForTouch: true,
    });
    // or the videojs function accepts a DOM element instead
    // const player = videojs(document.querySelector('vid1'));
    // 传递一个回调函数给player的ready()方法
    player.ready(function() {
      // 自动播放检测
      const promise = player.play();

      if(promise !== undefined){
        promise.then(function(){
          // Autoplay started!
          console.log('autoplay started!')
        }).catch(function(error){
          // Autoplay was prevented.
          console.log('autoplay was prevented.')
        })
      }

      // =========音量操作=========
      // 获取当前音量值
      const howLoudIsIt = player.volume();
      console.log(howLoudIsIt); // 0.0 to 1.0 (0% to 100%)
      // 设置音量值，值在0.0到1.0之间
      player.volume(0.5); // 0.5 = 50%
      
      // 在不带参数的情况下调用它将返回当前视频中音量的状态
      // 获取，返回false
      console.log(player.muted());
      // 设置为true
      player.muted(true);
      // 再次获取，返回true
      console.log(player.muted());

      // ======== 全屏操作 =========
      // 获取视频是否全屏，使用isFullscreen()函数
      console.log(player.isFullscreen()); // false (default)
      // 设置全屏
      // player.isFullscreen(true);
      // 打印设置的值，返回true
      // console.log(player.isFullscreen(true));

      // 请求全屏
      // console.log(player.requestFullscreen()); // true or false (default)
      // 退出全屏
      // player.exitFullscreen(); // true or false (default)

      // 获取当前播放的时间
      console.log(player.currentTime());

      // 显示正在播放的视频的总时长
      console.log('当前视频总时长为：' + player.duration());
      // 视频剩余时长
      console.log('当前视频剩余长为：' + player.remainingTime());
      // 当前视频被缓冲的视频百分比
      console.log('当前视频被缓冲的百分比为：' + player.bufferedPercent());

    });
    // 监听player的ready事件
    player.on('ready', function(){
      this.addClass('my-example');
    });


    // 2.获取当前player的所有文本轨迹（字幕）[可选]
    const tracks = player.textTracks();
    for(let i = 0; i < tracks.length; i++){
      let track = tracks[i];
      // 找到英文字幕并显示
      if(track.kind === 'captions' && track.language === 'zh-CN'){
        track.mode = 'showing';  // or 'hidden' if you don't want it to be shown.  or 'disabled' for default
      }
    }


    // 3.使用音频轨道[可选,适用于多音频同时播放时]============
    const adTrack = new videojs.AudioTrack({
      id: 'alternate-audio-track',
      kind: 'translation',
      label: 'Spanish',
      language: 'en',
    });
    // 将音频轨道添加到播放器的音频轨道列表中
    player.audioTracks().addTrack(adTrack);


    // 3.1 监听音频轨道变化事件[可选] 
    // 获取当前播放器的VideoTrackList对象
    const audioTrackList = player.audioTracks();
    // 监听‘change’事件
    audioTrackList.addEventListener('change', function(){
      // 记录当前启用的AudioTrack标签
      for(let i = 0; i < audioTrackList.length; i++){
        const track = audioTrackList[i];

        if(track.enabled){
          videojs.log(track.label);
          return;
        }
      }
    });


    // 3.2 删除音频轨道
    const aTrack = player.audioTracks().getTrackById('alternate-audio-track');
    player.audioTracks().removeTrack(aTrack);



    // 4.使用视频轨道[可选，适用于多视频同时播放时]===============
    // 创建一个obj类型的视频轨道
    const vdTrack = new videojs.VideoTrack({
      id: 'alternate-video-track',
      kind: 'commentary',
      label: 'Director\'s commentary',
      language: 'en',
    });
    // 将视频轨道添加到播放器的视频轨道列表中
    player.videoTracks().addTrack(vdTrack);


    // 4.1 监听视频轨道变化事件[可选] 
    // 获取当前播放器的VideoTrackList对象
    const videoTrackList = player.videoTracks();
    // 监听‘change’事件
    videoTrackList.addEventListener('change', function(){
      // 记录当前启用的VideoTrack标签
      for(let i = 0; i < videoTrackList.length; i++){
        const track = videoTrackList[i];

        if(track.enabled){
          videojs.log(track.label);
          return;
        }
      }
    });


    // 4.2 删除视频轨道
    const vTrack = player.videoTracks().getTrackById('alternate-video-track');
    player.videoTracks().removeTrack(vTrack);



    // type 2
    // const jsplayer = videojs('vid2', {
    //   controls: true,
    //   autoplay: false,
    //   preload: 'auto'
    // });
    // or the videojs function accepts a DOM element instead
    // const jsplayer = videojs(document.querySelector('vid2'));

    // ============= 5.一般使用 ==============
    // 5.1视频播放完后移除播放器（players）,使用dispose()方法
    player.on('ended', function(){
      this.dispose();
    });


    // 5.2 设置/修改播放器的音量（音量函数接受0-1之间的数字）




    

    console.log(videojs.players.vid1)



    // ========can-autoplay.js检测自动播放=============
    // 浏览器是否支持音频自动播放
    canAutoplay.audio().then(({result}) => {
      if (result === true) {
        // Can auto-play
      } else {
        // Can not auto-play
      }
    })

    // 浏览器是否支持视频自动播放
    canAutoplay.video().then(({result}) => {
      if (result === true) {
        // Can autoplay
      } else {
        // Can not autoplay
      }
    })
  </script>
</body>
</html>